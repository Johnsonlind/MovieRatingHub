<!-- ==========================================
* 首页
* ========================================== -->
<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/png" href="/logos/home.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ratefuse 搜索并对比多平台影视评分</title>
    
    <!-- DNS预解析和预连接 -->
    <link rel="dns-prefetch" href="//image.tmdb.org">
    <link rel="preconnect" href="//image.tmdb.org" crossorigin="anonymous">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    
    <!-- 预加载关键字体资源 - 修改为更高优先级 -->
    <link rel="preload" href="/fonts/FontA.woff2" as="font" type="font/woff2" crossorigin="anonymous" fetchpriority="high">
    <link rel="preload" href="/fonts/FontB.woff2" as="font" type="font/woff2" crossorigin="anonymous" fetchpriority="high">
    
    <!-- 内联关键 CSS，包含字体声明 -->
    <style>
      /* Onest 字体 */
      @font-face {
        font-family: 'Onest';
        src: local('Onest'),
             url('/fonts/FontA.woff2') format('woff2-variations');
        font-weight: 100 900;
        font-display: swap;
        font-style: normal;
        unicode-range: U+0020-007E, U+00A0-00FF, U+0100-017F, U+1E80-1EFF;
        font-feature-settings: "kern", "liga", "clig", "calt";
        font-variation-settings: "wght" 400;
        text-rendering: optimizeLegibility;
      }
      
      /* 尚古等宽字体 */
      @font-face {
        font-family: 'ShangGuDengKuan';
        src: local('ShangGuDengKuan'),
             url('/fonts/FontB.woff2') format('woff2');
        font-weight: normal;
        font-display: swap;
        font-style: normal;
        unicode-range: U+0080-0103, U+0110-0113, U+011A-011B, U+0128-012B, U+0143-0144, U+0147-0148, U+014C-014F, U+0152-0153, U+0168-016D, U+0192, U+01A0-01A1, U+01AF-01B0, U+01CD-01DC, U+01F8-01F9, U+0251, U+0261, U+02BB, U+02C7, U+02C9-02CB, U+02D9, U+02EA-02EB, U+0300-0301, U+0304, U+0307, U+030C, U+0391-03A1, U+03A3-03A9, U+03B1-03C9, U+0401, U+0410-044F, U+0451, U+1100-11FF, U+1E3E-1E3F, U+1EA0-1EF9, U+2002-2003, U+2010-2016, U+2018-201A, U+201C-201E, U+2020-2022, U+2025-2027, U+2030, U+2032-2033, U+2035, U+2039-203C, U+2042, U+2047-2049, U+2051, U+2074, U+20A9, U+20AB-20AC, U+20DD-20DE, U+2100, U+2103, U+2105, U+2109-210A, U+210F, U+2113, U+2116, U+2121-2122, U+2126-2127, U+212B, U+212E, U+2135, U+213B, U+2160-216B, U+2170-217B, U+2190-2199, U+21B8-21B9, U+21C4-21C6, U+21CB-21CC, U+21D0, U+21D2, U+21D4, U+21E6-21E9, U+21F5, U+2200, U+2202-2203, U+2205-220B, U+220F, U+2211-2213, U+2215, U+221A, U+221D-2220, U+2223, U+2225-222E, U+2234-2237, U+223D, U+2243, U+2245, U+2248, U+224C, U+2252, U+2260-2262, U+2264-2267, U+226A-226B, U+226E-226F, U+2272-2273, U+2276-2277, U+2282-2287, U+228A-228B, U+2295-2299, U+22A0, U+22A5, U+22BF, U+22DA-22DB, U+22EF, U+2305-2307, U+2312, U+2318, U+2329-232A, U+23B0-23B1, U+23BE-23CC, U+23CE, U+23DA-23DB, U+2423, U+2460-25AB, U+25B1-25B3, U+25B6-25B7, U+25BC-25BD, U+25C0-25C1, U+25C6-25CC, U+25CE-25D3, U+25E2-25E6, U+25EF, U+2600-2603, U+2605-2606, U+2609, U+260E-260F, U+2616-2617, U+261C-261F, U+262F, U+2640-2642, U+2660-266F, U+2672-267D, U+26A0, U+26BD-26BE, U+2702, U+2713, U+271A, U+273D, U+273F-2740, U+2756, U+2776-2793, U+27A1, U+2934-2935, U+29BF, U+29FA-29FB, U+2B05-2B07, U+2B1A, U+2B95, U+2E80-2E99, U+2E9B-2EF3, U+2F00-2FD5, U+2FF0-2FFB, U+3000-3030, U+3033-303F, U+3041-3096, U+3099-30FF, U+3105-312F, U+3131-318E, U+3190-31BB, U+31C0-31E3, U+31F0-321E, U+3220-332B, U+332D-4DB5, U+4DB9, U+4E00-9FEF, U+A960-A97C, U+AC00-D7A3, U+D7B0-D7C6, U+D7CB-D7FB, U+F900-FA6D, U+FB01-FB02, U+FE10-FE19, U+FE30-FE52, U+FE54-FE66, U+FE68-FE6B, U+FF01-FFBE, U+FFC2-FFC7, U+FFCA-FFCF, U+FFD2-FFD7, U+FFDA-FFDC, U+FFE0-FFE6, U+FFE8-FFEE, U+1F100-1F10C, U+1F110-1F169, U+1F170-1F1AC, U+1F200-1F202, U+1F210-1F23B, U+1F240-1F248, U+1F250-1F251, U+30C28, U+31350;
        font-feature-settings: "kern", "liga", "clig", "calt";
        text-rendering: optimizeLegibility;
      }
      
      /* 字体渲染 - 修改初始不透明度为0.01而非0，避免完全不可见 */
      :root {
        font-family: 'Onest', 'ShangGuDengKuan', system-ui, -apple-system;
        opacity: 0.01;
        transition: opacity 0.1s ease-in-out;
        text-size-adjust: 100%;
        -webkit-text-size-adjust: 100%;
      }

      /* 字体加载状态样式 */
      :root.fonts-loaded {
        opacity: 1;
      }
      
      :root.fonts-timeout,
      :root.fonts-failed {
        font-family: system-ui, -apple-system;
        opacity: 1;
      }
      
      /* 字体渲染 */
      body {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-synthesis: none;
        font-feature-settings: "kern", "liga", "clig", "calt";
      }
    </style>
    
    <!-- 字体加载检测脚本 - 优化超时时间 -->
    <script>
      // 主题设置
      const theme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', theme);
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }

      // 字体加载检测
      const FONT_LOAD_TIMEOUT = 1500; // 减少到1.5秒超时
      const FONT_LOAD_FALLBACK_TIMEOUT = 50; // 减少到50ms

      // 字体加载状态跟踪
      let fontsLoaded = false;

      // 字体加载主逻辑
      Promise.race([
        // 尝试加载字体
        Promise.all([
          document.fonts.load('1em Onest'),
          document.fonts.load('1em ShangGuDengKuan')
        ]).then(() => {
          fontsLoaded = true;
          document.documentElement.classList.add('fonts-loaded');
          // 记录成功加载时间
          performance.mark('fonts-loaded');
        }),
        // 超时处理
        new Promise(resolve => setTimeout(() => {
          if (!fontsLoaded) {
            console.warn('字体加载超时，使用后备方案');
            document.documentElement.classList.add('fonts-loaded', 'fonts-timeout');
          }
          resolve();
        }, FONT_LOAD_TIMEOUT))
      ]).catch(() => {
        // 加载失败处理
        setTimeout(() => {
          if (!fontsLoaded) {
            console.warn('字体加载失败，使用后备方案');
            document.documentElement.classList.add('fonts-loaded', 'fonts-failed');
          }
        }, FONT_LOAD_FALLBACK_TIMEOUT);
      });

      // 添加性能监控
      if (window.PerformanceObserver) {
        const observer = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            if (entry.name === 'fonts-loaded') {
              console.log(`字体加载耗时: ${entry.startTime}ms`);
            }
          }
        });
        observer.observe({ entryTypes: ['mark', 'measure'] });
      }
      
      // 添加资源提示
      if ('connection' in navigator) {
        if (navigator.connection.saveData) {
          // 如果用户开启了省流量模式，不预加载字体
          document.documentElement.classList.add('fonts-loaded', 'fonts-timeout');
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
